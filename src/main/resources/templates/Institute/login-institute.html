<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>로그인</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://www.google.com/recaptcha/enterprise.js?render=6LdH9ygqAAAAAN6WdRyVPVTe7eoOS32DUCZXyZvK"></script>
    <style>
        .gradient-custom {
          background: linear-gradient(to right, rgba(106, 17, 203, 1), rgba(37, 117, 252, 1))
        }
    </style>
</head>
<body class="gradient-custom">
<section class="d-flex vh-100">
    <div class="container-fluid row justify-content-center align-content-center">
        <div class="card bg-dark" style="border-radius: 1rem;">
            <div class="card-body p-5 text-center">
                <h2 class="text-white">통합 LOGIN</h2>
                <p class="text-white-50 mt-2 mb-5">서비스를 사용하려면 로그인을 해주세요!</p>

                <div class = "mb-2">
                    <form action="/api/login" method="POST" id="loginForm">
                        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}" />
                        <div class="mb-3">
                            <label class="form-label text-white">Email address</label>
                            <input type="text" class="form-control" name="email">
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-white">Password</label>
                            <input type="password" class="form-control" name="password">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </form>

                    <button type="button" class="btn btn-secondary mt-3" onclick="location.href='/signup/institute'">회원가입</button>
                </div>
                <a href="/oauth2/authorization/google" class="btn btn-sm btn-success active" role="button">Google Login</a><br>
                <a href="/oauth2/authorization/naver" class="btn btn-sm btn-success active" role="button">Naver Login</a><br>
            </div>
        </div>
    </div>
    <script>
         document.getElementById('loginForm').addEventListener('submit', function(event) {
         event.preventDefault(); // 기본 제출 동작 방지
         grecaptcha.enterprise.ready(async () => {
             try {
                 const token = await grecaptcha.enterprise.execute('6LdH9ygqAAAAAN6WdRyVPVTe7eoOS32DUCZXyZvK', {action: 'login'});
                
                 // AJAX 요청으로 폼 데이터 전송
                 $.ajax({
                     url: 'http://localhost:8080/api/login', // 서버 엔드포인트
                     type: 'POST',
                     contentType: 'application/json',
                     data: JSON.stringify({
                            email: $('input[name="email"]').val(),
                            password: $('input[name="password"]').val(),
                            recaptchaResponse: token
                        }),
                     success: function(response) {
                         // 서버 응답 처리
                         console.log('서버 응답:', response);
                     },
                     error: function(xhr, status, error) {
                         // 오류 처리
                         console.error('전송 오류:', error);
                     }
                 });
             } catch (error) {
                 console.error('reCAPTCHA 인증 오류:', error);
             }
         });
     });
    </script>
</section>
</body>
</html>